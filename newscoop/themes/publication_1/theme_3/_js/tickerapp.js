var Document=Backbone.Model.extend({day:86400,month:2592E3,year:31536E3,types:{news:"omni",newswire:"article",dossier:"dossier",user:"user",tweet:"twitter",event:"event",comment:"comment",link:"link",blog:"omni"},relDate:function(a){a=new Date(this.get(a));a=Math.ceil(Math.abs((new Date).getTime()-a.getTime())/1E3);if(60>a)return"vor "+a+" Sek.";if(3600>a)return"vor "+(a/60).toFixed()+" Min.";if(a<this.day)return"vor "+(a/3600).toFixed()+" Std.";if(a<this.month)return a=(a/this.day).toFixed(),"vor "+
a+" "+(1==a?"Tag":"Tagen");if(a<this.year)return a=(a/this.month).toFixed(),"vor "+a+" "+(1==a?"Monat":"Monaten");a=(a/this.year).toFixed();return"vor "+a+" "+(1==a?"Jahr":"Jahren")},getTemplateType:function(){if(!this.get("type")in this.types)console.log(this.get("type"));else return this.types[this.get("type")]},getTweet:function(){var a=this.get("tweet");return!a?a:a.replace(/(http:\/\/t.co\/[\w]+)/,'<a href="$1" rel="nofollow" target="_blank">$1</a>')},getEventDate:function(){return this.get("event_date")?
this.get("event_date"):""},getEventTime:function(){return this.get("event_time")?this.get("event_time")+" Uhr":""},getEventTitle:function(){return this.escape("title").replace(/ \([-0-9]+\)$/,"")}}),DocumentCollection=Backbone.Collection.extend({model:Document,topics:{},buildParams:function(){var a={};this.query&&(a.q=this.query);this.type&&(a.type=this.type);this.date&&(a.date=this.date);this.start&&(a.start=this.start);this.sortf&&(a.sort=this.sortf);this.source&&(a.source=this.source);this.section&&
(a.section=this.section);this.topics.length&&(a.topic=this.topics.join());return a},url:function(){var a=this.buildParams();a.format="json";return"?"+jQuery.param(a)},nav:function(){var a=this.buildParams();return"?"+jQuery.param(a)},parse:function(a){this.response=a;this.query=a.responseHeader.params.q;this.count=parseInt(a.response.numFound);this.start=parseInt(a.response.start);this.rows=parseInt(a.responseHeader.params.rows);this.type=a.responseHeader.params.type;this.date=a.responseHeader.params.date;
this.source=a.responseHeader.params.source;this.section=a.responseHeader.params.section;this.facets=this.parseFacetFields(a);this.sortf=a.responseHeader.params.sort;this.topics=a.responseHeader.params.topic;return a.response.docs},hasSuggestion:function(){return this.response.spellcheck&&0!==this.response.spellcheck.suggestions.length},getSuggestion:function(){return this.response.spellcheck.suggestions[3]},parseFacetFields:function(a){if(!a.facet_counts)return{};for(var b={},a=a.facet_counts.facet_fields.type?
a.facet_counts.facet_fields.type:a.facet_counts.facet_fields.section,c=0;c<a.length;c+=2)b[a[c]]=a[c+1];b.article=b.news+b.newswire;return b},toggleTopic:function(a){var b=_.indexOf(this.topics,a);-1!==b?this.topics.splice(b,1):this.topics.push(a)}}),TickerView=Backbone.View.extend({tagName:"section",types:{twitter:"tweet"},initialize:function(){this.template=_.template($("#ticker-"+this.getType(this.model)+"-template").html())},render:function(){$(this.el).html(this.template({doc:this.model})).addClass(this.getType(this.model));
return this},getType:function(){return this.model.getTemplateType()in this.types?this.types[this.model.getTemplateType()]:this.model.getTemplateType()}}),TickerListView=Backbone.View.extend({initialize:function(){this.collection.bind("reset",this.render,this)},render:function(){var a=$(this.el);a.find("section").detach();this.collection.each(function(b){b=new TickerView({model:b});a.find("footer").before(b.render().el)});return this}});